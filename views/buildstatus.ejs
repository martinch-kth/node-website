<!DOCTYPE html>
<html lang="en">
<head>

    <% include partials/script %>

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/jstree/3.3.8/themes/default/style.min.css"/>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jstree/3.3.8/jstree.min.js"></script>

    <link rel="stylesheet" href="/stylesheets/buildstatus.css">

    <link href="/stylesheets/fontawesome-free-5.14.0-web/css/all.css" rel="stylesheet"> <!--load all styles -->


    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="/stylesheets/bootstrap.min.css">

    <link rel="stylesheet" href="/stylesheets/semantic.css">
    <link rel="stylesheet" href="/stylesheets/text_search_style.css">

    <% include partials/head %>
</head>
<body>


<div class="row">
    <div class="column">
        <br id="main-container" style="padding-left: 50px">
        <% include partials/menu %>
    </div>
</div>


<div class="ui four cards" id="ongoingTasksContainer" style="padding-right: 50px;">
</div>

<div class="ui card">
    <div class="content" style="background-color: lightgreen">

        <h2 class="ui tiny icon header">
            <i class="desktop icon"></i>
            <div class="ui header">#12 - Peregrin - 1 day ago</div>
        </h2>
    </div>


    <div class="content">

        <div class="event">
            <div class="content">

                <h2 class="ui tiny icon header">
                    <i class="clock icon" id="imuststyle">2:45h
                    </i>
                </h2>

            </div>
        </div>


        <h4 class="ui sub header">Build name</h4>
        <div class="ui medium feed">
            <div class="event">
                <div class="content">

                    <table class="ui definition table">
                        <tbody>
                        <tr>
                            <td class="two wide column">Modulename</td>
                            <td>Failed</td>
                        </tr>
                        <tr>
                            <td>Modulename</td>
                            <td>Failed</td>
                        </tr>
                        <tr>
                            <td>Modulename</td>
                            <td>Failed</td>
                        </tr>
                        <tr>
                            <td>Modulename</td>
                            <td>Failed</td>
                        </tr>
                        </tbody>
                    </table>

                </div>
            </div>

            <div class="ui form">
                <div class="ui message" style="height:100px;overflow: scroll;">
                    <div class="header">Console log</div>
                    <div class="ui list" >
                    <div class="scrolling content">
                        <p>Very long content goes here</p>
                        <p>Very long content goes here</p><p>Very long content goes here</p><p>Very long content goes here</p><p>Very long content goes here</p><p>Very long content goes here</p><p>Very long content goes here</p><p>Very long content goes here</p><p>Very long content goes here</p><p>Very long content goes here</p><p>Very long content goes here</p><p>Very long content goes here</p><p>Very long content goes here</p><p>Very long content goes here</p><p>Very long content goes here</p><p>Very long content goes here</p><p>Very long content goes here</p><p>Very long content goes here</p><p>Very long content goes here</p>
                    </div>
                    </div>
                </div>
            </div>



            <script>

                /*
                var out = document.getElementById("out");
                var c = 0;
                var add = setInterval(function() {
                    // allow 1px inaccuracy by adding 1
                    var isScrolledToBottom = out.scrollHeight - out.clientHeight <= out.scrollTop + 1;

                    console.log(out.scrollHeight - out.clientHeight,  out.scrollTop + 1);


                    var newElement = document.createElement("div");
                    newElement.innerHTML = c++;
                    out.appendChild(newElement);
                    // scroll to bottom if isScrolledToBotto
                    if(isScrolledToBottom)
                        out.scrollTop = out.scrollHeight - out.clientHeight;
                }, 1000);


                Test Template
                -----------------------------------------



            <div class="ui two column grid" style="padding-bottom: 10px">

                <div class="column">
                    <div class="event">
                        <div class="content">

                            <div class="ui statistics">
                                <div class="red statistic">
                                    <div class="value">
                                        3
                                    </div>
                                    <div class="label">
                                        builds have failed
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="column">
                    <div class="event">
                        <div class="content">

                            <div class="ui statistics">
                                <div class="green statistic">
                                    <div class="value">
                                        7
                                    </div>
                                    <div class="label">
                                        builds have succeed
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="content">

                <div class="event">
                    <div class="content">

                        <div class="ui relaxed divided list">
                            <div class="item">
                                <i class="large jenkins middle aligned icon"></i>
                                <div class="content">
                                    <div class="description">Last build (#23), 1 days 0 hr ago</div>
                                </div>
                            </div>
                            <div class="item">
                                <i class="large jenkins middle aligned icon"></i>
                                <div class="content">
                                    <div class="description">Last stable build (#23), 1 days 0 hr ago</div>
                                </div>
                            </div>
                            <div class="item">
                                <i class="large jenkins middle aligned icon"></i>
                                <div class="content">
                                    <div class="description">Last successful build (#23), 1 days 0 hr ago</div>
                                </div>
                            </div>

                                <div class="item">
                                    <i class="large jenkins middle aligned icon"></i>
                                    <div class="content">
                                        <div class="description">Last failed build (#20), 1 days 2 hr ago</div>
                                    </div>
                                </div>
                                <div class="item">
                                    <i class="large jenkins middle aligned icon"></i>
                                    <div class="content">
                                        <div class="description">Last unsuccessful build (#20), 1 days 2 hr ago</div>
                                    </div>
                                </div>
                                <div class="item">
                                    <i class="large jenkins middle aligned icon"></i>
                                    <div class="content">
                                        <div class="description">Last completed build (#23), 1 days 0 hr ago</div>
                                    </div>
                                </div>

                          </div>
                        </div>
                    </div>
                </div>
        </div>
    </div>
</div>




*/

            </script>



<script>

    // Update the bootstrap grid once the tasks are added
    function updateTaskContainerHead(containerId, ref_name) {
        let containerHead = document.getElementById(containerId);
        // Take the row headings and make an HTML container out of them

        // Parameter man behöver för varje REF
        //
        // Tool: använder detta tool converter: http://pojo.sodhanalibrary.com/ConvertToVariable
        //
        // ID, tid osv.. så man ta bort och lägga till?.. hur uppdaterar man allt..?

        $('<div class="ui card" style="width: 809px;">'+
            '    <div class="content" style="background-color: lightgreen">'+
            ''+
            '        <h2 class="ui tiny icon header">'+
            '            <i class="desktop icon"></i>'+
            '            <div class="ui header">'+ref_name+'</div>'+
            '        </h2>'+
            '    </div>'+
            ''+
            ''+
            '    <div class="content">'+
            ''+
            '        <div class="event">'+
            '            <div class="content">'+
            ''+
            '                <h2 class="ui tiny icon header">'+
            '                    <i class="clock icon" id="imuststyle">2:45h'+
            '                    </i>'+
            '                </h2>'+
            ''+
            '            </div>'+
            '        </div>'+
            ''+
            ''+
            '        <h4 class="ui sub header">Build name</h4>'+
            '        <div class="ui medium feed">'+
            '            <div class="event">'+
            '                <div class="content">'+
            ''+
            '                    <table class="ui definition table">'+
            '                        <tbody>'+
            '                        <tr>'+
            '                            <td class="two wide column">Modulename</td>'+
            '                            <td>Failed</td>'+
            '                        </tr>'+
            '                        <tr>'+
            '                            <td>Modulename</td>'+
            '                            <td>Failed</td>'+
            '                        </tr>'+
            '                        <tr>'+
            '                            <td>Modulename</td>'+
            '                            <td>Failed</td>'+
            '                        </tr>'+
            '                        <tr>'+
            '                            <td>Modulename</td>'+
            '                            <td>Failed</td>'+
            '                        </tr>'+
            '                        </tbody>'+
            '                    </table>'+
            ''+
            '                </div>'+
            '            </div>'+
            ''+



            '<div class="FixedHeightContainer">' +
            '<pre id="out" class="Content"></pre>' +
            '</div>' +



            ''+
            '            <div class="ui two column grid" style="padding-bottom: 10px">'+
            ''+
            '                <div class="column">'+
            '                    <div class="event">'+
            '                        <div class="content">'+
            ''+
            '                            <div class="ui statistics">'+
            '                                <div class="red statistic">'+
            '                                    <div class="value">'+
            '                                        3'+
            '                                    </div>'+
            '                                    <div class="label">'+
            '                                        builds have failed'+
            '                                    </div>'+
            '                                </div>'+
            '                            </div>'+
            '                        </div>'+
            '                    </div>'+
            '                </div>'+
            ''+
            ''+
            '                <div class="column">'+
            '                    <div class="event">'+
            '                        <div class="content">'+
            ''+
            '                            <div class="ui statistics">'+
            '                                <div class="green statistic">'+
            '                                    <div class="value">'+
            '                                        7'+
            '                                    </div>'+
            '                                    <div class="label">'+
            '                                        builds have succeed'+
            '                                    </div>'+
            '                                </div>'+
            '                            </div>'+
            '                        </div>'+
            '                    </div>'+
            '                </div>'+
            '            </div>'+
            ''+
            ''+
            '            <div class="content">'+
            ''+
            '                <div class="event">'+
            '                    <div class="content">'+
            ''+
            '                        <div class="ui relaxed divided list">'+
            '                            <div class="item">'+
            '                                <i class="large jenkins middle aligned icon"></i>'+
            '                                <div class="content">'+
            '                                    <div class="description">Last build (#23), 1 days 0 hr ago</div>'+
            '                                </div>'+
            '                            </div>'+
            '                            <div class="item">'+
            '                                <i class="large jenkins middle aligned icon"></i>'+
            '                                <div class="content">'+
            '                                    <div class="description">Last stable build (#23), 1 days 0 hr ago</div>'+
            '                                </div>'+
            '                            </div>'+
            '                            <div class="item">'+
            '                                <i class="large jenkins middle aligned icon"></i>'+
            '                                <div class="content">'+
            '                                    <div class="description">Last successful build (#23), 1 days 0 hr ago</div>'+
            '                                </div>'+
            '                            </div>'+
            ''+
            '                                <div class="item">'+
            '                                    <i class="large jenkins middle aligned icon"></i>'+
            '                                    <div class="content">'+
            '                                        <div class="description">Last failed build (#20), 1 days 2 hr ago</div>'+
            '                                    </div>'+
            '                                </div>'+
            '                                <div class="item">'+
            '                                    <i class="large jenkins middle aligned icon"></i>'+
            '                                    <div class="content">'+
            '                                        <div class="description">Last unsuccessful build (#20), 1 days 2 hr ago</div>'+
            '                                    </div>'+
            '                                </div>'+
            '                                <div class="item">'+
            '                                    <i class="large jenkins middle aligned icon"></i>'+
            '                                    <div class="content">'+
            '                                        <div class="description">Last completed build (#23), 1 days 0 hr ago</div>'+
            '                                    </div>'+
            '                                </div>'+
            ''+
            '                          </div>'+
            '                        </div>'+
            '                    </div>'+
            '                </div>'+
            ''+
            '        </div>'+
            '    </div>'+
            '</div>'
    )
            .appendTo(containerHead);}

        updateTaskContainerHead('ongoingTasksContainer','Eka-mini1');

</script>





<script src="javascript/socket.io.js"></script>

<ul id="events"></ul>
<script>

    /* funkar!!
    const $events = document.getElementById('events');

    const newItem = (content) => {
        const item = document.createElement('li');
        item.innerText = content;
        return item;
    };

    const socket = io();

    socket.on('connect', () => {
        $events.appendChild(newItem('connect'));
    });

    */
</script>


<script src="javascript/socket.io-stream.js"></script>
<script>

    $(document).ready(function() {

    //    $(document).ready(function(){
    //        var $textarea = $('#out');
    //        $textarea.scrollTop($textarea[0].scrollHeight);
    //    });

        $(function() {
            var socket = io.connect('http://localhost:3000');

            socket.on("connect",function() {
                console.log("on connect");

                ss(socket).on('jenkins-log', function(stream,data) {


                    console.log('received',data);

                    console.log('datalength: ',data.length);


                    // får inte nyradstecken såhär...  med JSON.stringfy får jag de utskrivna.. nu vill ja ha det fint!!

                    // använder nu <pre> element istället för DIV.. inte bra?..kanske försöka fixa till div??...
                    $("#out").append(data) //.replace(/(?:\r\n|\r|\n)/g, '<br>'))

                    var element = document.getElementById("out");
                    element.scrollTop = element.scrollHeight;


                        //.replace(/(?:\r\n|\r|\n)/g, '<br>'))

                 //   document.getElementById("out").innerHTML = JSON.stringify(data);


                    // SCROLLA TILL LÄNGST NER!!: http://jsfiddle.net/dotnetCarpenter/KpM5j/

                 //   $(JSON.stringify(data.message)).appendTo('#out');


                //    $("#out").attr("src","data:image/png;base64,"+window.btoa(binaryString));




                                //       stream.on('data', function(data) {
                                  //        console.log('data****************************')

                                     //      $(data).appendTo('#out');

                                       //    for(var i=0;i<data.length;i++) {
                                       //        binaryString+=String.fromCharCode(data[i]);
                                       //    }

                                    //   });



                    stream.on('end', function(data) {
                        console.log('end')
                        //     $("#img").attr("src","data:image/png;base64,"+window.btoa(binaryString));

                        //     binaryString = "";
                    });
                });
            });
        });
    });

</script>



</body>
</html>
